---
import BaseLayout from "../layouts/baseLayout.astro";
import Link from "../components/link.astro";
import Blogpost from "../components/blogpost.astro";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import "../styles/global.css";
const page_title = "Welcome";

const all_posts = Object.values(
    import.meta.glob("./posts/*.mdx", { eager: true }),
);

const stick_figures = import.meta.glob<{ default: ImageMetadata }>(
    "../assets/stick_figures/*.png",
);

const stick_images = Object.values(stick_figures);

all_posts.sort((a: any, b: any) => {
    if (a.frontmatter.date < b.frontmatter.date) {
        return 1;
    }
    if (a.frontmatter.date > b.frontmatter.date) {
        return -1;
    }
    return 0;
});
---

<style>
    .intro_paragraph {
        display: flex;
        place-items: center;
    }
    .intro_p {
        flex: 2;
    }
    .intro_img {
        text-align: center;
        flex: 1;
    }
    #img_container {
        display: grid;
        grid-template-areas: "stack";
        cursor: pointer;
    }
    .img_list {
        grid-area: stack;
        width: 100%;
        height: 100%;
        opacity: 0;
        transition: opacity 0.4s ease-in-out;
        pointer-events: none;
    }
    .img_list.active {
        opacity: 1;
        pointer-events: auto;
    }
</style>

<script>
    document.addEventListener("astro:page-load", () => {
        const image_container = document.getElementById("img_container");
        const images = document.querySelectorAll(".img_list");
        let currentIndex = 0;
        image_container!.addEventListener("click", () => {
            let nextIndex;
            do {
                nextIndex = Math.floor(Math.random() * images.length);
            } while (nextIndex === currentIndex);
            images[currentIndex].classList.remove("active");
            images[nextIndex].classList.add("active");
            currentIndex = nextIndex;
        });
    });
</script>

<BaseLayout page_title={page_title}>
    <h1>Welcome!</h1>
    <div class="intro_paragraph">
        <div class="intro_p">
            <p>
                Hi I'm Kevin and this website serves as the corner of the
                internet where I put my stuff(not a lot of it right now). I'm
                currently a student at UCSB studying computer science with a
                minor in math.
            </p>
            <p>
                Most of the stuff here is text but I'm learning to draw so
                hopefully I have some artwork here soon. Also links with an
                arrow are external links and anything without the arrow are
                internal links.
            </p>
            <p>
                Find Me: <br />
                <Link link="https://github.com/Makkerel" name="Github" />
                <br />
                <Link
                    link="https://www.linkedin.com/in/kevin-zhao-955069334"
                    name="LinkedIn"
                />
                <br />
                <Link
                    link="https://ucsb.joinhandshake.com/profiles/xddrqq"
                    name="Handshake"
                />
            </p>
        </div>
        <div class="intro_img">
            Click Me!
            <div id="img_container">
                <Image
                    src={stick_images[0]()}
                    alt="begin_image"
                    class="img_list active"
                />
                {
                    stick_images
                        .slice(1)
                        .map((image) => (
                            <Image
                                src={image()}
                                alt="stick man"
                                class="img_list"
                            />
                        ))
                }
            </div>
        </div>
    </div>
    <h2>Recent Blogs</h2>
    {
        all_posts
            .slice(0, 3)
            .map((post: any) => (
                <Blogpost
                    url={post.url}
                    title={post.frontmatter.title}
                    date={post.frontmatter.date}
                    description={post.frontmatter.description}
                />
            ))
    }
</BaseLayout>
